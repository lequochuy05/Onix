<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Dashboard</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h1 class="mb-4 text-center">Trang Qu·∫£n L√Ω</h1>

    <div class="row justify-content-center">

        <!-- Danh m·ª•c -->
        <div class="col-md-4 mb-4">
            <div class="card text-white bg-info h-100">
                <div class="card-body text-center">
                    <h5 class="card-title">Danh m·ª•c</h5>
                    <p class="card-text fs-4" th:text="${dbModel.categoryCount}">0</p>
                    <a href="/admin/categories" class="btn btn-light mt-2">Qu·∫£n l√Ω danh m·ª•c</a>
                </div>
            </div>
        </div>


        <!-- S·∫£n ph·∫©m b√°n ch·∫°y -->
        <div class="col-md-4 mb-4">
            <div class="card text-white bg-info h-100">
                <div class="card-body text-center">
                    <h5 class="card-title">S·∫£n ph·∫©m b√°n ch·∫°y</h5>
                    <p class="card-text fs-4" th:text="${dbModel.bestSellerCount}">0</p>
                    <a href="/admin/products/best-sellers" class="btn btn-light mt-2">Qu·∫£n l√Ω s·∫£n ph·∫©m b√°n ch·∫°y</a>
                </div>
            </div>
        </div>

        <!-- S·∫£n ph·∫©m -->
        <div class="col-md-4 mb-4">
            <div class="card text-white bg-primary h-100">
                <div class="card-body text-center">
                    <h5 class="card-title">S·∫£n ph·∫©m</h5>
                    <p class="card-text fs-4" th:text="${dbModel.productCount}">0</p>
                    <a href="/admin/products" class="btn btn-light mt-2">Qu·∫£n l√Ω s·∫£n ph·∫©m</a>
                </div>
            </div>
        </div>

        <!-- ƒê∆°n h√†ng -->
        <div class="col-md-4 mb-4">
            <div class="card text-white bg-success h-100">
                <div class="card-body text-center">
                    <h5 class="card-title">ƒê∆°n h√†ng</h5>
                    <p class="card-text fs-4" th:text="${dbModel.orderCount}">0</p>
                    <a href="/admin/orders" class="btn btn-light mt-2">Qu·∫£n l√Ω ƒë∆°n h√†ng</a>
                </div>
            </div>
        </div>

        <!-- Ng∆∞·ªùi d√πng -->
        <div class="col-md-4 mb-4">
            <div class="card text-white bg-warning h-100">
                <div class="card-body text-center">
                    <h5 class="card-title">Ng∆∞·ªùi d√πng</h5>
                    <p class="card-text fs-4" th:text="${dbModel.userCount}">0</p>
                    <a href="/admin/users" class="btn btn-light mt-2">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</a>
                </div>
            </div>
        </div>

         <!-- Chat bot -->
         <div class="col-md-4 mb-4">
            <div class="card text-white bg-warning h-100">
                <div class="card-body text-center">
                    <h5 class="card-title">Chat bot</h5>
                    <p></p>
                    <a href="/admin/chats" class="btn btn-light mt-2">Qu·∫£n l√Ω tin nh·∫Øn</a>
                </div>
            </div>
        </div>

       <!-- Bi·ªÉu ƒë·ªì doanh thu theo th√°ng -->
        <div class="mt-5">
            <h4 class="text-center mb-4">üìä Doanh thu theo th√°ng</h4>
            <div class="text-center mb-3">
                <label class="me-2">Ch·ªçn nƒÉm:</label>
                <select id="yearSelector" onchange="drawRevenueChart()">
                    <option value="">T·∫•t c·∫£</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                </select>
            </div>
            
            <canvas id="monthlyRevenueChart" height="100"></canvas>
            
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script th:inline="javascript">
            async function drawRevenueChart() {
                const selectedYear = document.getElementById("yearSelector").value;
                const url = selectedYear ? `/admin/dashboard/revenue-monthly?year=${selectedYear}` : "/admin/dashboard/revenue-monthly";

                const response = await fetch(url);
                const data = await response.json();

                const labels = Object.keys(data);
                const values = Object.values(data);

                const ctx = document.getElementById('monthlyRevenueChart').getContext('2d');
                if (window.revenueChartInstance) {
                    window.revenueChartInstance.destroy();
                }

                window.revenueChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Doanh thu (VND)',
                            data: values,
                            fill: false,
                            borderColor: '#28a745',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString() + ' VND';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            drawRevenueChart();
        </script>

        
    </div>
</div>

<!-- Bootstrap JS (t√πy ch·ªçn n·∫øu b·∫°n c√≥ modal, toast, dropdown...) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
